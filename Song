//
//  Song.swift
//  LocalFiles
//
//  Created by JV on 6/11/25.
//

import UIKit
import AVFoundation

struct Song: Identifiable {
    let id = UUID()
    let url: URL
    let title: String
    let artist: String
    let artwork: UIImage?

    init(url: URL) {
        self.url = url
        let asset = AVAsset(url: url)

        // Title
        if let item = asset.commonMetadata.first(where: { $0.commonKey == AVMetadataKey.commonKeyTitle }),
           let value = item.stringValue {
            title = value
        } else {
            title = url.deletingPathExtension().lastPathComponent
        }

        // Artist
        if let item = asset.commonMetadata.first(where: { $0.commonKey == AVMetadataKey.commonKeyArtist }),
           let value = item.stringValue {
            artist = value
        } else {
            artist = "Unknown Artist"
        }

        // Artwork
        if let item = asset.commonMetadata.first(where: { $0.commonKey == AVMetadataKey.commonKeyArtwork }),
           let data = item.dataValue,
           let image = UIImage(data: data) {
            artwork = image
        } else {
            artwork = nil
        }
    }
}
